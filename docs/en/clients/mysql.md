### mysql # MySQL #> MySQL {tpl-git PHPDaemon/Clients/MySQL}

```php
namespace PHPDaemon\Clients\MySQL;
```

Клиент для СУБД [MySQL](http://mysql.com/)

#### use # Использование

@TODO

В вашем приложении вам следует получать объект MySQLClient посредством `Daemon::$appResolver->getInstanceByAppName('MySQLClient')` и использовать как описано ниже.

##### prepare # Подготовка объекта соединения

```
/*
  @method getConnection
  @description Establishes connection.
  @param string Optional. Address.
  @return integer Connection's ID.
*/
```

Вам следует получить объект MySQLClientSession посредством метода $MySQLClient->getConnection(), затем вы можете положить ваш текущий запрос/сессию/что-нибудь еще в текущий контекст соединения (в свойство context).

Затем используйте:

```php
$this->sql->onConnected(
    function($sql, $success) {
        if (!$success) {
            return;
        }
        // your connection-dependent code
    }
);
```

#### examples # Примеры

```php
$sql->query('SHOW VARIABLES', 
   function($sql, $success) {
      $sql->context->queryResult = $sql->resultRows; // save the result
      $sql->context->wakeup(); // wake up the request immediately
   }
);
```

Когда callback-функция вызвана, $sql->context содержит ваш объект, который вы туда положили перед этим. $sql->resultRows хранит результат в виде массива ассоциативных массивов. $sql->resultFields содержит поля ответа в виде массива ассоциативных массивов.

<!-- include-namespace path="\PHPDaemon\Clients\MySQL" commit="48bf0ac1a287568045136e87d28a6e65bf2f9756" level="" access="" -->
#### connection # Class Connection {tpl-git PHPDaemon/Clients/MySQL/Connection.php}

```php
namespace PHPDaemon\Clients\MySQL;
class Connection extends \PHPDaemon\Network\ClientConnection;
```

##### consts # Constants

<md:const>
const STATE_STANDBY = 0;
@TODO DESCR
</md:const>

<md:const>
const STATE_BODY = 1;
@TODO DESCR
</md:const>

<md:const>
const PHASE_GOT_INIT = 1;
@TODO DESCR
</md:const>

<md:const>
const PHASE_AUTH_SENT = 2;
@TODO DESCR
</md:const>

<md:const>
const PHASE_AUTH_ERR = 3;
@TODO DESCR
</md:const>

<md:const>
const PHASE_HANDSHAKED = 4;
@TODO DESCR
</md:const>

<md:const>
const RS_STATE_HEADER = 0;
@TODO DESCR
</md:const>

<md:const>
const RS_STATE_FIELD = 1;
@TODO DESCR
</md:const>

<md:const>
const RS_STATE_ROW = 2;
@TODO DESCR
</md:const>

##### properties # Properties

<md:prop>
/**
	 * Sequence
	 * @var integer
	 */
public $seq;
</md:prop>

<md:prop>
/**
	 * Client flags
	 * @var integer
	 */
public $clientFlags;
</md:prop>

<md:prop>
/** @var */
public $threadId;
</md:prop>

<md:prop>
/** @var */
public $scramble;
</md:prop>

<md:prop>
/** @var */
public $serverver;
</md:prop>

<md:prop>
/** @var */
public $serverCaps;
</md:prop>

<md:prop>
/** @var */
public $serverLang;
</md:prop>

<md:prop>
/**
	 * Server flags: http://dev.mysql.com/doc/internals/en/status-flags.html
	 * @var integer
	 */
public $serverStatus;
</md:prop>

<md:prop>
/**
	 * Number of warnings generated by the command
	 * @var integer
	 */
public $warnCount;
</md:prop>

<md:prop>
/** @var */
public $message;
</md:prop>

<md:prop>
/**
	 * Charset number (see MySQL charset list)
	 * @var integer
	 */
public $charsetNumber;
</md:prop>

<md:prop>
/**
	 * Database name
	 * @var string
	 */
public $dbname;
</md:prop>

<md:prop>
/**
	 * Result rows
	 * @var array
	 */
public $resultRows;
</md:prop>

<md:prop>
/**
	 * Result fields
	 * @var array
	 */
public $resultFields;
</md:prop>

<md:prop>
/**
	 * Property holds a reference to user's object
	 * @var object
	 */
public $context;
</md:prop>

<md:prop>
/**
	 * INSERT_ID()
	 * @var integer
	 */
public $insertId;
</md:prop>

<md:prop>
/**
	 * Affected rows
	 * @var integer
	 */
public $affectedRows;
</md:prop>

<md:prop>
/**
	 * Protocol version
	 * @var integer
	 */
public $protover;
</md:prop>

<md:prop>
/**
	 * Timeout
	 * @var integer
	 */
public $timeout;
</md:prop>

<md:prop>
/**
	 * Error number
	 * @var integer
	 */
public $errno;
</md:prop>

<md:prop>
/**
	 * Error message
	 * @var integer
	 */
public $errmsg;
</md:prop>

<md:prop>
/**
	 * @var object Associated pool
	 */
public $pool;
</md:prop>

##### methods # Methods

<md:method>
/**
	 * Executes the given callback when/if the connection is handshaked
	 * @param  callable $cb Callback
	 * @callback ( Connection $conn, boolean $success )
	 * @return void
	 */
public function onConnected($cb)
</md:method>

<md:method>
/**
	 * Called when the connection is handshaked (at low-level), and peer is ready to recv. data
	 * @return void
	 */
public function onReady()
</md:method>

<md:method>
/**
	 * Sends a packet
	 * @param  string $packet Data
	 * @return boolean Success
	 */
public function sendPacket($packet)
</md:method>

<md:method>
/**
	 * Builds length-encoded binary string
	 * @param  string $s String
	 * @return string Resulting binary string
	 */
public function buildLenEncodedBinary($s)
</md:method>

<md:method>
/**
	 * Parses length-encoded binary integer
	 * @return integer Result
	 */
public function parseEncodedBinary()
</md:method>

<md:method>
/**
	 * Parse length-encoded string
	 * @return integer Result
	 */
public function parseEncodedString()
</md:method>

<md:method>
/**
	 * Generates auth. token
	 * @param  string $scramble Scramble string
	 * @param  string $password Password
	 * @return string Result
	 */
public function getAuthToken($scramble, $password)
</md:method>

<md:method>
/**
	 * Sends auth. packet
	 * @return string Result
	 */
public function auth()
</md:method>

<md:method>
/**
	 * Sends SQL-query
	 * @param  string   $q        Query
	 * @param  callable $callback Optional. Callback called when response received
	 * @callback ( Connection $conn, boolean $success )
	 * @return boolean Success
	 */
public function query($q, $callback = NULL)
</md:method>

<md:method>
/**
	 * Sends echo-request
	 * @param  callable $callback Optional. Callback called when response received
	 * @callback ( Connection $conn, boolean $success )
	 * @return boolean Success
	 */
public function ping($callback = NULL)
</md:method>

<md:method>
/**
	 * Sends arbitrary command
	 * @param  string   $cmd      Command
	 * @param  string   $q        Data
	 * @param  callable $callback Optional
	 * @throws ConnectionFinished
	 * @callback ( Connection $conn, boolean $success )
	 * @return boolean Success
	 */
public function command($cmd, $q = '', $callback = NULL)
</md:method>

<md:method>
/**
	 * Sets default database name
	 * @param  string  $name   Database name
	 * @return boolean Success
	 */
public function selectDB($name)
</md:method>

<md:method>
/**
	 * Called when new data received
	 * @return void
	 */
public function onRead()
</md:method>

<md:method>
/**
	 * Called when the whole result received
	 * @return void
	 */
public function onResultDone()
</md:method>

<md:method>
/**
	 * Called when error occured
	 * @return void
	 */
public function onError()
</md:method>

#### connection-finished # Class ConnectionFinished {tpl-git PHPDaemon/Clients/MySQL/ConnectionFinished.php}

```php
namespace PHPDaemon\Clients\MySQL;
class ConnectionFinished extends \PHPDaemon\Exceptions\ConnectionFinished;
```

#### pool # Class Pool {tpl-git PHPDaemon/Clients/MySQL/Pool.php}

```php
namespace PHPDaemon\Clients\MySQL;
class Pool extends \PHPDaemon\Network\Client;
```

##### consts # Constants

<md:const>
const CLIENT_LONG_PASSWORD = 1;
new more secure passwords
</md:const>

<md:const>
const CLIENT_FOUND_ROWS = 2;
Found instead of affected rows
</md:const>

<md:const>
const CLIENT_LONG_FLAG = 4;
Get all column flags
</md:const>

<md:const>
const CLIENT_CONNECT_WITH_DB = 8;
One can specify db on connect
</md:const>

<md:const>
const CLIENT_NO_SCHEMA = 16;
Don't allow database.table.column
</md:const>

<md:const>
const CLIENT_COMPRESS = 32;
Can use compression protocol
</md:const>

<md:const>
const CLIENT_ODBC = 64;
Odbc client
</md:const>

<md:const>
const CLIENT_LOCAL_FILES = 128;
Can use LOAD DATA LOCAL
</md:const>

<md:const>
const CLIENT_IGNORE_SPACE = 256;
Ignore spaces before '('
</md:const>

<md:const>
const CLIENT_PROTOCOL_41 = 512;
New 4.1 protocol
</md:const>

<md:const>
const CLIENT_INTERACTIVE = 1024;
This is an interactive client
</md:const>

<md:const>
const CLIENT_SSL = 2048;
Switch to SSL after handshake
</md:const>

<md:const>
const CLIENT_IGNORE_SIGPIPE = 4096;
IGNORE sigpipes
</md:const>

<md:const>
const CLIENT_TRANSACTIONS = 8192;
Client knows about transactions
</md:const>

<md:const>
const CLIENT_RESERVED = 16384;
Old flag for 4.1 protocol
</md:const>

<md:const>
const CLIENT_SECURE_CONNECTION = 32768;
New 4.1 authentication
</md:const>

<md:const>
const CLIENT_MULTI_STATEMENTS = 65536;
Enable/disable multi-stmt support
</md:const>

<md:const>
const CLIENT_MULTI_RESULTS = 131072;
Enable/disable multi-results
</md:const>

<md:const>
const COM_SLEEP = 0x00;
(none, this is an internal thread state)
</md:const>

<md:const>
const COM_QUIT = 0x01;
mysql_close
</md:const>

<md:const>
const COM_INIT_DB = 0x02;
mysql_select_db
</md:const>

<md:const>
const COM_QUERY = 0x03;
mysql_real_query
</md:const>

<md:const>
const COM_FIELD_LIST = 0x04;
mysql_list_fields
</md:const>

<md:const>
const COM_CREATE_DB = 0x05;
mysql_create_db (deprecated)
</md:const>

<md:const>
const COM_DROP_DB = 0x06;
mysql_drop_db (deprecated)
</md:const>

<md:const>
const COM_REFRESH = 0x07;
mysql_refresh
</md:const>

<md:const>
const COM_SHUTDOWN = 0x08;
mysql_shutdown
</md:const>

<md:const>
const COM_STATISTICS = 0x09;
mysql_stat
</md:const>

<md:const>
const COM_PROCESS_INFO = 0x0a;
mysql_list_processes
</md:const>

<md:const>
const COM_CONNECT = 0x0b;
(none, this is an internal thread state)
</md:const>

<md:const>
const COM_PROCESS_KILL = 0x0c;
mysql_kill
</md:const>

<md:const>
const COM_DEBUG = 0x0d;
mysql_dump_debug_info
</md:const>

<md:const>
const COM_PING = 0x0e;
mysql_ping
</md:const>

<md:const>
const COM_TIME = 0x0f;
(none, this is an internal thread state)
</md:const>

<md:const>
const COM_DELAYED_INSERT = 0x10;
(none, this is an internal thread state)
</md:const>

<md:const>
const COM_CHANGE_USER = 0x11;
mysql_change_user
</md:const>

<md:const>
const COM_BINLOG_DUMP = 0x12;
sent by the slave IO thread to request a binlog
</md:const>

<md:const>
const COM_TABLE_DUMP = 0x13;
LOAD TABLE ... FROM MASTER (deprecated)
</md:const>

<md:const>
const COM_CONNECT_OUT = 0x14;
(none, this is an internal thread state)
</md:const>

<md:const>
const COM_REGISTER_SLAVE = 0x15;
sent by the slave to register with the master (optional)
</md:const>

<md:const>
const COM_STMT_PREPARE = 0x16;
mysql_stmt_prepare
</md:const>

<md:const>
const COM_STMT_EXECUTE = 0x17;
mysql_stmt_execute
</md:const>

<md:const>
const COM_STMT_SEND_LONG_DATA = 0x18;
mysql_stmt_send_long_data
</md:const>

<md:const>
const COM_STMT_CLOSE = 0x19;
mysql_stmt_close
</md:const>

<md:const>
const COM_STMT_RESET = 0x1a;
mysql_stmt_reset
</md:const>

<md:const>
const COM_SET_OPTION = 0x1b;
mysql_set_server_option
</md:const>

<md:const>
const COM_STMT_FETCH = 0x1c;
mysql_stmt_fetch
</md:const>

<md:const>
const FIELD_TYPE_DECIMAL = 0x00;

</md:const>

<md:const>
const FIELD_TYPE_TINY = 0x01;

</md:const>

<md:const>
const FIELD_TYPE_SHORT = 0x02;

</md:const>

<md:const>
const FIELD_TYPE_LONG = 0x03;

</md:const>

<md:const>
const FIELD_TYPE_FLOAT = 0x04;

</md:const>

<md:const>
const FIELD_TYPE_DOUBLE = 0x05;

</md:const>

<md:const>
const FIELD_TYPE_NULL = 0x06;

</md:const>

<md:const>
const FIELD_TYPE_TIMESTAMP = 0x07;

</md:const>

<md:const>
const FIELD_TYPE_LONGLONG = 0x08;

</md:const>

<md:const>
const FIELD_TYPE_INT24 = 0x09;

</md:const>

<md:const>
const FIELD_TYPE_DATE = 0x0a;

</md:const>

<md:const>
const FIELD_TYPE_TIME = 0x0b;

</md:const>

<md:const>
const FIELD_TYPE_DATETIME = 0x0c;

</md:const>

<md:const>
const FIELD_TYPE_YEAR = 0x0d;

</md:const>

<md:const>
const FIELD_TYPE_NEWDATE = 0x0e;

</md:const>

<md:const>
const FIELD_TYPE_VARCHAR = 0x0f;

</md:const>

<md:const>
const FIELD_TYPE_BIT = 0x10;

</md:const>

<md:const>
const FIELD_TYPE_NEWDECIMAL = 0xf6;

</md:const>

<md:const>
const FIELD_TYPE_ENUM = 0xf7;

</md:const>

<md:const>
const FIELD_TYPE_SET = 0xf8;

</md:const>

<md:const>
const FIELD_TYPE_TINY_BLOB = 0xf9;

</md:const>

<md:const>
const FIELD_TYPE_MEDIUM_BLOB = 0xfa;

</md:const>

<md:const>
const FIELD_TYPE_LONG_BLOB = 0xfb;

</md:const>

<md:const>
const FIELD_TYPE_BLOB = 0xfc;

</md:const>

<md:const>
const FIELD_TYPE_VAR_STRING = 0xfd;

</md:const>

<md:const>
const FIELD_TYPE_STRING = 0xfe;

</md:const>

<md:const>
const FIELD_TYPE_GEOMETRY = 0xff;

</md:const>

<md:const>
const NOT_NULL_FLAG = 0x1;

</md:const>

<md:const>
const PRI_KEY_FLAG = 0x2;

</md:const>

<md:const>
const UNIQUE_KEY_FLAG = 0x4;

</md:const>

<md:const>
const MULTIPLE_KEY_FLAG = 0x8;

</md:const>

<md:const>
const BLOB_FLAG = 0x10;

</md:const>

<md:const>
const UNSIGNED_FLAG = 0x20;

</md:const>

<md:const>
const ZEROFILL_FLAG = 0x40;

</md:const>

<md:const>
const BINARY_FLAG = 0x80;

</md:const>

<md:const>
const ENUM_FLAG = 0x100;

</md:const>

<md:const>
const AUTO_INCREMENT_FLAG = 0x200;

</md:const>

<md:const>
const TIMESTAMP_FLAG = 0x400;

</md:const>

<md:const>
const SET_FLAG = 0x800;

</md:const>

##### properties # Properties

<md:prop>
/**
	 * @var string Default connection class
	 */
public $connectionClass;
</md:prop>

<md:prop>
/**
	 * @var string Name
	 */
public $name;
</md:prop>

<md:prop>
/**
	 * @var \PHPDaemon\Config\Section Configuration
	 */
public $config;
</md:prop>

<md:prop>
/**
	 * @var integer Max concurrency
	 */
public $maxConcurrency;
</md:prop>

<md:prop>
/**
	 * @var integer Max allowed packet
	 */
public $maxAllowedPacket;
</md:prop>

<md:prop>
/**
	 * @var object|null Application instance object
	 */
public $appInstance;
</md:prop>

##### methods # Methods

<md:method>
/**
	 * Escapes the special symbols with trailing backslash
	 * @param string $string
	 * @return string
	 */
public static function escape($string)
</md:method>

<md:method>
/**
	 * 
	 * @param $string
	 * @return string
	 */
public static function value($mixed)
</md:method>

<md:method>

public static function values($arr)
</md:method>

<md:method>
/**
	 * Escapes the special symbols with a trailing backslash
	 * @param $string
	 * @return string
	 */
public static function likeEscape($string)
</md:method>


<!--/ include-namespace -->
